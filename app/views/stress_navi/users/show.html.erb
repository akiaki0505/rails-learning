<% content_for(:title, 'User Details') %>

<main class="flex-1 overflow-y-auto p-6 md:p-8 bg-gray-100">
        
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-800">User Details</h1>
            <p class="text-sm text-gray-500 mt-1">Information about the user account.</p>
        </div>
        
        <%= link_to stress_navi_users_path, class: "text-gray-500 hover:text-gray-700 text-sm font-medium flex items-center transition-colors" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-1">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            Back to List
        <% end %>
    </div>

    <div class="bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden">
        
        <div class="bg-gray-50/50 p-8 border-b border-gray-100 flex flex-col sm:flex-row items-center sm:items-start text-center sm:text-left">
            <div class="h-20 w-20 rounded-full bg-sky-100 text-sky-600 flex items-center justify-center text-2xl font-bold uppercase mb-4 sm:mb-0 sm:mr-6 shadow-inner">
                <%= @user.email[0..1] %>
            </div>
            
            <div class="flex-1">
                <h2 class="text-2xl font-bold text-gray-900"><%= @user.name %></h2>
                <p class="text-gray-500 font-medium"><%= @user.email %></p>
                
                <div class="mt-4 flex flex-wrap justify-center sm:justify-start gap-2">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                        ID: #<%= @user.id %>
                    </span>
                </div>
            </div>

            <div class="mt-6 sm:mt-0">
                <%= link_to edit_stress_navi_user_path(@user), class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 transition-colors" do %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="-ml-1 mr-2 h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                    </svg>
                    Edit User
                <% end %>
            </div>
        </div>

        <div class="p-8">
            <dl class="grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2">
                
                <div class="sm:col-span-1">
                    <dt class="text-sm font-medium text-gray-500">Full Name</dt>
                    <dd class="mt-1 text-sm text-gray-900 font-semibold"><%= @user.name %></dd>
                </div>

                <div class="sm:col-span-1">
                    <dt class="text-sm font-medium text-gray-500">Email Address</dt>
                    <dd class="mt-1 text-sm text-gray-900"><%= @user.email %></dd>
                </div>

                <div class="sm:col-span-1">
                    <dt class="text-sm font-medium text-gray-500">Created at</dt>
                    <dd class="mt-1 text-sm text-gray-900">
                        <%= @user.created_at.strftime('%Y/%m/%d %H:%M') %>
                    </dd>
                </div>

                <div class="sm:col-span-1">
                    <dt class="text-sm font-medium text-gray-500">Updated at</dt>
                    <dd class="mt-1 text-sm text-gray-900">
                        <%= @user.updated_at.strftime('%Y/%m/%d %H:%M') %>
                    </dd>
                </div>

            </dl>
        </div>
        
    </div>

    <div class="mt-8 bg-white rounded-xl shadow-md border border-gray-100 p-6">
        <h3 class="text-lg font-bold text-gray-800 mb-4">Stress Level (Last 2 Weeks)</h3>
        <div class="w-full h-64 md:h-80">
            <canvas id="scoreChart"></canvas>
        </div>
    </div>

    <script>
    document.addEventListener("turbo:load", function() {
        // キャンバス要素を取得
        const ctx = document.getElementById('scoreChart');

        // すでにチャートがある場合は一度破棄する（画面遷移で重複描画されるのを防ぐため）
        if (window.myChart instanceof Chart) {
            window.myChart.destroy();
        }

        // チャートの作成
        window.myChart = new Chart(ctx, {
            type: 'line', // 折れ線グラフ
            data: {
                // Rubyの配列(@chart_labels)をJSON形式でJSに渡す
                labels: <%= @chart_labels.to_json.html_safe %>, 
                datasets: [
                    // ▼ 1つ目: ボーダーライン (15点) ※こちらを先に書くと奥に表示されます
                    {
                        label: 'Threshold (15)',
                        data: <%= @border_line.to_json %>, // [15, 15, 15...]
                        
                        // 目立つデザイン設定
                        borderColor: 'rgba(255, 99, 132, 0.8)', // 赤色
                        borderWidth: 3,             // 線を太く
                        borderDash: [10, 5],        // 点線にする (10px線引いて5px空ける)
                        pointRadius: 0,             // 丸い点(プロット)は表示しない
                        fill: false,                // 塗りつぶしなし
                        tension: 0                  // 直線
                    },
                    // ▼ 2つ目: 実際のスコア (既存)
                    {
                        label: 'Total Score',
                        data: <%= @chart_data.to_json %>,
                        
                        // (既存のデザイン設定...)
                        borderColor: 'rgb(14, 165, 233)', 
                        backgroundColor: 'rgba(14, 165, 233, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: 'white',
                        pointBorderColor: 'rgb(14, 165, 233)',
                        pointRadius: 4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // 親要素の高さに合わせる
                scales: {
                    y: {
                        beginAtZero: true, // 0からスタートするか
                        // max: 100,      // 必要なら最大値を固定
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)' // グリッド線の色
                        }
                    },
                    x: {
                        grid: {
                            display: false // 縦のグリッド線は消す
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false // 凡例(Total Scoreという文字)を消す
                    }
                }
            }
        });
    });
    
    // 初回読み込み対策 (Turboを使わない場合やリロード時用)
    if (document.readyState === "complete" || document.readyState === "interactive") {
        document.dispatchEvent(new Event("turbo:load"));
    }
</script>
</main>